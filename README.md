# SoilGeneHS 

This is the repository for *Ensemble feature selection of cotton hyperspectral reflectance to predict soil health genes* (under review).

## Abstract

Monitoring soil microbiome metrics is currently costly and low-throughput. However, by measuring hyperspectral reflectance of cotton (*Gossypium hirsutum*), machine learning models can predict abundance levels for certain genes in the adjacent soil, increasing throughput. In this study, the prediction capabilities of elastic net models were measured for five soil health genes (16S rRNA, 18S rRNA, *pho*A, *cbb*LR, and *ure*C) using cotton hyperspectral reflectance values from 350-2500 nm. *pho*A, *cbb*LR, and *ure*C were partially predictable, but 18S rRNA was not predictable using this methodology. 16S rRNA, though, was consistently predictable using hyperspectral data. Knowing which regions of the spectrum are most influential for predicting gene levels can reduce data size, improve future modeling, and depending on the region, allow more accessible sensors. To find the important regions, this study tested five feature selection methods: mutual information, agglomerative clustering, embedded linear coefficients, permutation importance, and genetic algorithms (both standalone and on the results of the other methods). No method gave consistently superior or inferior results for all genes, but the methods tended to select wavebands from the visible light regions (particularly yellow-orange light) over infrared regions. Additionally, this study demonstrated that restricting wavebands to visible light improved the model predicting 16S rRNA (RMSE = 0.724, MAE = 0.576, R^2^ = 0.501 on the standardized variable). The results suggest that infrared wavebands are less important than visible light wavebands in predicting soil microbiome genes, allowing future studies to use more accessible sensors.

## Repo directory structure

### cache

All the trained model objects. These have been preserved in case of future interest, so this study's results can be replicated exactly (important in the context of stochastic processes). The file names denote the values for each of the dimensions involved, separated by underscores:

- Region: Which wavebands were considered. 
    - "all" = all wavebands
    - "vis" = visible light wavebands only
- Gene: The gene being predicted.
    - "bact" = 16S rRNA
    - "cbblr" = *cbb*LR
    - "fungi" = 18S rRNA
    - "phoa" = *pho*A
    - "urec" = *ure*C
- Method: The feature importance method used.
    - "baseline" = no feature selection
    - "cluster" = agglomerative clustering
    - "coeffs" = embedded linear coefficients
    - "consensus" = genetic algorithm, on the results of the other feature importance methods
    - "ga" = genetic algorithm
    - "mi" = mutual information
    - "pi" = permutation importance

### data

The data used in this study. *RKNGHStressPCAPSR.csv* gives the hyperspectral data, and *RKNGHStress.csv* gives the rest of the data. *data_consol.csv* is the consolidation of the two tables for use in this project's code.

### figures

The figures in the manuscript.

### python

This is the primary code for the project. *main.ipynb* and *main.py* should be equivalent.

### r

This shows the analysis of results and the code to generate the manuscript figures. It is best not to open *analysis.qmd* directly; instead, open *SoilGeneHS.Rproj* from the root directory in RStudio, and inside RStudio navigate to *r/analysis.qmd*.

### results

The results generated by the code in *python/* and analyzed in *r/*.
